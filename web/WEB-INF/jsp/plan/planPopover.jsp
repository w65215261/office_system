<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>


<!-- widget content -->
<div class="widget-body" id="workHourFlag">
  <div class="row" style="text-align: center;margin: 10px;">
    <div class="form-group col-md-8" id="hour">
      <div class="col-md-12"><h6>小时</h6></div>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="1">
        <span class="flag">01</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="2">
        <span class="flag">02</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="3">
        <span class="flag">03</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="4">
        <span class="flag">04</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="5">
        <span class="flag">05</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="6">
        <span class="flag">06</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="7">
        <span class="flag">07</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="8">
        <span class="flag">08</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="9">
        <span class="flag">09</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="10">
        <span class="flag">10</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="11">
        <span class="flag">11</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="12">
        <span class="flag">12</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="13">
        <span class="flag">13</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="14">
        <span class="flag">14</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="15">
        <span class="flag">15</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="16">
        <span class="flag">16</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="17">
        <span class="flag">17</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="18">
        <span class="flag">18</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="19">
        <span class="flag">19</span>
      </label><label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="20">
        <span class="flag">20</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="21">
        <span class="flag">21</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="22">
        <span class="flag">22</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="23">
        <span class="flag">23</span>
      </label>
      <label class="col-md-2 control-label">
        <input type="radio" class="hidden-input" name="style-0a" value="24">
        <span class="flag">24</span>
      </label>
    </div>

    <div class="form-group col-md-4" id="minute">
      <div><p class="col-md-4"></p><h6 class="col-md-8" style="text-align: right">分钟</h6></div>
      <label class="col-md-3 control-label">
        <span></span>
      </label>
      <label class="col-md-3 control-label">
        <span>|</span>
      </label>
      <label class="col-md-6 control-label">
        <input type="radio" class="hidden-input" name="style-0" value="0">
        <span class="flag">00</span>
      </label>
      <label class="col-md-3 control-label">
        <span></span>
      </label>
      <label class="col-md-3 control-label">
        <span>|</span>
      </label>
      <label class="col-md-6 control-label">
        <input type="radio" class="hidden-input" name="style-0" value="15">
        <span class="flag">15</span>
      </label>
      <label class="col-md-3 control-label">
        <span ></span>
      </label>
      <label class="col-md-3 control-label">
        <span>|</span>
      </label>
      <label class="col-md-6 control-label">
        <input type="radio" class="hidden-input" name="style-0" value="30">
        <span class="flag">30</span>
      </label>
      <label class="col-md-3 control-label">
        <span></span>
      </label>
      <label class="col-md-3 control-label">
        <span>|</span>
      </label>
      <label class="col-md-6 control-label">
        <input type="radio" class="hidden-input" name="style-0" value="45">
        <span class="flag">45</span>
      </label>
    </div>
  </div>
  <div style="text-align: center;margin: 10px;">
    <a href="JavaScript:workHour(1);" class="btn btn-primary btn-xs" style="width: 50px;">提交</a>&nbsp;
    <a href="javascript:workHour(0);" class="btn btn-default btn-xs" style="width: 50px;">取消</a>
  </div>
</div>

<script type="text/javascript">
  function saveWorkHourSum(oid,i){
    var findOid = $("#oid2").val();
    var workHourName= "#workHourName"+i;
    var workHour = "#workHour"+i;
    var workhourDate = "#workhourDate"+i;
    var workHourNameVal = $(workHourName).val();//名字
    var workHourVal = $(workHour).text();//工时
    var workhourDateVal = $(workhourDate).val();//日期
    var workhourBzVal = $('.summernote5').eq(i).code();//备注
    workHourVal = $.trim(workHourVal.substr(0, workHourVal.length-1));


    $.ajax({
      type: "POST",
      url: '/projectTask/updateWorkHour.do',
      data:{
        taskOid:findOid,
        oid:oid,
        workHourName:workHourNameVal,
        workHour:workHourVal,
        workHourDate:workhourDateVal,
        workHourContent:workhourBzVal
      },
      success: function (data) {
        if (data == "success") {
          showWorkHour(findOid);
        } else {
          alert('更新失败!');
        }
      },
      // 调用出错执行的函数
      error: function () {

      }
    });
  }
  function workHour(k){
    var flag = '${flag}';
    var oid = '${oid}';
    if(flag == "-1"){
      if(k == 1){
        var hour = $("#hour input[type=radio]:checked").val();
        var minute = $("#minute input[type=radio]:checked").val();
        if(hour == undefined && minute == undefined){
          $('#inputTest').popover('hide');
        }else{
          if(hour == undefined){
            hour = 0;
          }
          if(minute == undefined){
            minute = "00";
          }else if(minute == 0){
            minute = "00";
          }else if(minute == 15){
            minute = "25";
          }else if(minute == 30){
            minute = "50";
          }else if(minute == 45){
            minute = "75";
          }

          $("#popoverSpan").text(hour+"."+minute+"小时");
          $('#inputTest').popover('hide');
        }
      }else{
        $('#inputTest').popover('hide');
      }
    }else{
      var workHour= "#workHour"+flag;
      if(k == 1){
        var hour1 = $("#hour input[type=radio]:checked").val();
        var minute1 = $("#minute input[type=radio]:checked").val();
        if(hour1 == undefined && minute1 == undefined){
          $('#inputTest').popover('hide');
        }else{
          if(hour1 == undefined){
            hour1 = 0;
          }
          if(minute1 == undefined){
            minute1 = "00";
          }else if(minute1 == 0){
            minute1 = "00";
          }else if(minute1 == 15){
            minute1 = "25";
          }else if(minute1 == 30){
            minute1 = "50";
          }else if(minute1 == 45){
            minute1 = "75";
          }

          $(workHour).html("<i class='fa fa-clock-o'></i>&nbsp;&nbsp;"+hour1+"."+minute1+"h");
          $(workHour).popover('hide');
          saveWorkHourSum(oid,flag);
        }
      }else{
        $(workHour).popover('hide');
      }
    }
  }




  $(function(){
    $("#hour input[type=radio]").click(function(){
      $("#hour input[type=radio]").parent().removeClass("btn-primary");
      $("#hour input[type=radio]").next().removeAttr("style");
      $(this).next().css({color:"#FFFFFF","text-align":"center"});
      $(this).parent().addClass("btn-primary");
    });

  });
  $(function(){
    $("#minute input[type=radio]").click(function(){
      $("#minute input[type=radio]").parent().removeClass("btn-primary");
      $("#minute input[type=radio]").next().removeAttr("style");
      $(this).next().css({color:"#FFFFFF","text-align":"center"});
      $(this).parent().addClass("btn-primary");
    });

  });

</script>
<style type="text/css">
  .hidden-input {
    opacity: 0;
    position: absolute;
    z-index: -1;
  }

  .widget-body{

    padding-left: 10px;
    padding-right: 10px;
  }
  .flag{
    cursor: pointer;
  }
  #workHourFlag{
    width: 250px;
  }
  .popover {
    width: 800px;
    z-index   : 1060;
    height: auto;
  }
</style>